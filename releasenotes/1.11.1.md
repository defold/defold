# Defold 1.11.1

## Summary
* __BREAKING CHANGE__: ([#11163](https://github.com/defold/defold/pull/11178)) Allow setting game.project properties using editor scripts (by vlaaad)
* __NEW__: ([#11052](https://github.com/defold/defold/pull/11052)) Set PBR properties for shaders (by Jhonnyg)
* __NEW__: ([#5889](https://github.com/defold/defold/pull/11218)) New functions: `gui.set_layout()` and `gui.get_layouts()` (by AGulev)
* __NEW__: ([#9302](https://github.com/defold/defold/pull/11220)) Doubled the object limit to 65,534 per collection (by AGulev)
* __NEW__: ([#6849,#10579](https://github.com/defold/defold/pull/11222)) Added orthographic camera projection modes  (by AGulev)
* __NEW__: ([#10255](https://github.com/defold/defold/pull/11224)) Add support for enabling file logging in release mode   (by AGulev)
* __NEW__: ([#3625](https://github.com/defold/defold/pull/11230)) Added `sort_order` option to `render.draw()` in `render_script` (by AGulev)
* __NEW__: ([#10590](https://github.com/defold/defold/pull/10707)) Add function to get Vulkan handles to dmsdk (by ekharkunov)
* __NEW__: ([#7902,#9498](https://github.com/defold/defold/pull/11226)) Added new function `go.update_world_transform()` (by AGulev)
* __NEW__: ([#9291](https://github.com/defold/defold/pull/11239)) Added `start_time` and `start_frame` parameters for `sound.play()` (by AGulev)
* __NEW__: ([#11147](https://github.com/defold/defold/pull/11152)) Disallow non-top-level go.property calls in scripts (by vlaaad)
* __NEW__: ([#10601](https://github.com/defold/defold/pull/11148)) Move deleted files into trash bin (by vlaaad)
* __NEW__: ([#11158](https://github.com/defold/defold/pull/11170)) Show literal labels for user-defined properties (by matgis)
* __FIX__: ([#11208](https://github.com/defold/defold/pull/11209)) Properly calculate new polygon centroid when scaling a collision object shape (Box2d v3) (by JCash)
* __FIX__: ([#11216](https://github.com/defold/defold/pull/11217)) Fix remotery web-profiler connection on macOS (by AGulev)
* __FIX__: ([#11204](https://github.com/defold/defold/pull/11204)) Vulkan fix validation errors (by Jhonnyg)
* __FIX__: ([#11233](https://github.com/defold/defold/pull/11233)) On opengl the graphics frame start now sets the default framebuffer (by JCash)
* __FIX__: ([#11235](https://github.com/defold/defold/pull/11235)) New public APIs (by ekharkunov)
* __FIX__: ([#10921](https://github.com/defold/defold/pull/11180)) Vulkan improve texture upload performance (by Jhonnyg)
* __FIX__: ([#9917](https://github.com/defold/defold/pull/9943)) Fix frustrum culling for sprites with pivot point (by ekharkunov)
* __FIX__: ([#11159](https://github.com/defold/defold/pull/11159)) Suggest fetching libraries when modifying game.project dependencies (by vlaaad)
* __FIX__: ([#11141](https://github.com/defold/defold/pull/11179)) Fix Console not working when the custom resolution feature is enabled (by AGulev)
* __FIX__: ([#11189](https://github.com/defold/defold/pull/11189)) Decrease editor size by 12 MB (by vlaaad)
* __FIX__: ([#11174](https://github.com/defold/defold/issues/11174)) Beta editors do not use the beta build server by default (by NaakkaDev)
* __FIX__: ([#11191](https://github.com/defold/defold/pull/11234)) Fixed code editor freeze when matching against very long strings (by matgis)

## Engine
__NEW__: ([#11052](https://github.com/defold/defold/pull/11052)) __'Set PBR properties for shaders'__ by Jhonnyg
Material properties from a GLTF file are now exposed into shaders via a special hard-coded uniform:

```glsl
uniform PbrMaterial
{
    // Common properties
    vec4 pbrAlphaCutoffAndDoubleSidedAndIsUnlit; // R: alphaCutoff (Default=0.5), G: doubleSided (Default=false), B: unlit (Default=false)
    vec4 pbrCommonTextures;                      // R: use normalTexture, G: use occlusionTexture, B: use emissiveTexture
    PbrMetallicRoughness  pbrMetallicRoughness;
    PbrClearCoat pbrClearCoat;
   ... etc.
}
```

All properties that are available in our data format is now set in a model components material, if they exist in the shader. Here is the material specification from the engine source, which contains all the fields we currently support:
https://github.com/defold/defold/blob/23147f091896d079ec1cdba1e6648f2b31f3e1be/engine/rig/proto/rig/rig_ddf.proto#L154

To read more about how this works, head over to the [manual entry](https://defold.com/manuals/).

**Note: There is currently no PBR shader as part of the builtins. This will be included at a later time, but in the meanwhile you can use the Defold [PBR extension](https://github.com/defold/defold-pbr).**

__NEW__: ([#5889](https://github.com/defold/defold/pull/11218)) __'New functions: `gui.set_layout()` and `gui.get_layouts()`'__ by AGulev
Added new functions `gui.set_layout()` and `gui.get_layouts()`:

```lua
local ok = gui.set_layout("Portrait")
  if not ok then
      print("Portrait layout not found in this scene")
  end
```

```lua
local layouts = gui.get_layouts()
for id, size in pairs(layouts) do
    print(id, size.x, size.y)
end
```

A new checkbox, `Auto Layout Selection`, has been added to Display Profiles. It disables automatic layout detection in the project:  

![](https://raw.githubusercontent.com/defold/doc/8a8bfa1f08eed87e9683b359407b425f11ab2a32/docs/en/manuals/images/gui-layouts/new_profiles.png)

__NEW__: ([#9302](https://github.com/defold/defold/pull/11220)) __'Doubled the object limit to 65,534 per collection'__ by AGulev
You can now use double the number of objects per collection compared to before: 65,534.

__NEW__: ([#6849,#10579](https://github.com/defold/defold/pull/11222)) __'Added orthographic camera projection modes '__ by AGulev
New functionality for camera added:
- Added orthographic camera modes: ORTHO_MODE_FIXED, ORTHO_MODE_AUTO_FIT (contain), and ORTHO_MODE_AUTO_COVER (zoom).
- New Camera properties in Editor: “Orthographic Mode” (available only when Orthographic Projection is enabled).
- Lua API: `camera.get_orthographic_mode()` and `camera.set_orthographic_mode()` 

```lua
camera.get_orthographic_mode("#camera")
camera.set_orthographic_mode("#camera", camera.ORTHO_MODE_AUTO_FIT)
```

__NEW__: ([#10255](https://github.com/defold/defold/pull/11224)) __'Add support for enabling file logging in release mode  '__ by AGulev
You can now enable file logging in Release mode.  
The previous `Write Log` option has been deprecated and replaced with a new `Write Log File` setting, which offers three choices: `Never`, `Debug`, and `Always`.  

<img width="967" height="339" alt="CleanShot 2025-09-12 at 15 22 00@2x" src="https://github.com/user-attachments/assets/b7bd7237-d701-47a3-93a4-d1982cc68690" />

__NEW__: ([#3625](https://github.com/defold/defold/pull/11230)) __'Added `sort_order` option to `render.draw()` in `render_script`'__ by AGulev
You can now choose from the following sort orders when using `render.draw()`:  
- `render.SORT_BACK_TO_FRONT` (default)  
- `render.SORT_FRONT_TO_BACK`  
- `render.SORT_NONE`

__NEW__: ([#10590](https://github.com/defold/defold/pull/10707)) __'Add function to get Vulkan handles to dmsdk'__ by ekharkunov
Following functions are the part of public SDK now:
```cpp
void AddVertexStream(HVertexStreamDeclaration stream_declaration, dmhash_t name_hash, uint32_t size, Type type, bool normalize);
AdapterFamily GetInstalledAdapterFamily();
HTexture NewTexture(HContext context, const TextureCreationParams& params);
void DeleteTexture(HContext context, HTexture texture);
void SetTexture(HContext context, HTexture texture, const TextureParams& params);
void SetTextureAsync(HContext context, HTexture texture, const TextureParams& params, SetTextureAsyncCallback callback, void* user_data);
void SetTextureParams(HContext context, HTexture texture, TextureFilter min_filter, TextureFilter mag_filter, TextureWrap uwrap, TextureWrap vwrap, float max_anisotropy);
uint32_t GetTextureResourceSize(HContext context, HTexture texture);
uint16_t GetTextureWidth(HContext context, HTexture texture);
uint16_t GetTextureHeight(HContext context, HTexture texture);
uint16_t GetTextureDepth(HContext context, HTexture texture);
uint16_t GetOriginalTextureWidth(HContext context, HTexture texture);
uint16_t GetOriginalTextureHeight(HContext context, HTexture texture);
uint8_t GetTextureMipmapCount(HContext context, HTexture texture);
TextureType GetTextureType(HContext context, HTexture texture);
uint8_t GetNumTextureHandles(HContext context, HTexture texture);
uint32_t GetTextureUsageHintFlags(HContext context, HTexture texture);
uint32_t GetTextureStatusFlags(HContext context, HTexture texture);
void EnableTexture(HContext context, uint32_t unit, uint8_t id_index, HTexture texture);
void DisableTexture(HContext context, uint32_t unit, HTexture texture);
const char* GetTextureTypeLiteral(TextureType texture_type);
const char* GetTextureFormatLiteral(TextureFormat format);
uint32_t GetMaxTextureSize(HContext context);
```

Added following platform-dependent functions for Vulkan to public SDK:
```cpp
VkDevice VulkanGetDevice(HContext context);
VkPhysicalDevice VulkanGetPhysicalDevice(HContext context);
VkInstance VulkanGetInstance(HContext context);
uint16_t VulkanGetGraphicsQueueFamily(HContext context);
VkQueue VulkanGetGraphicsQueue(HContext context);
VkRenderPass VulkanGetRenderPass(HContext context);
VkCommandBuffer VulkanGetCurrentFrameCommandBuffer(HContext context);
bool VulkanCreateDescriptorPool(VkDevice vk_device, uint16_t max_descriptors, VkDescriptorPool* vk_descriptor_pool_out);
```

__NEW__: ([#7902,#9498](https://github.com/defold/defold/pull/11226)) __'Added new function `go.update_world_transform()`'__ by AGulev
A new function `go.update_world_transform()` has been added. It recalculates the world transform of an object along with its entire hierarchy up to the root objects.

__NEW__: ([#9291](https://github.com/defold/defold/pull/11239)) __'Added `start_time` and `start_frame` parameters for `sound.play()`'__ by AGulev
You can now specify `start_time` or `start_frame` (audio frame) when calling `sound.play()`.

__FIX__: ([#11208](https://github.com/defold/defold/pull/11209)) __'Properly calculate new polygon centroid when scaling a collision object shape (Box2d v3)'__ by JCash


__FIX__: ([#11216](https://github.com/defold/defold/pull/11217)) __'Fix remotery web-profiler connection on macOS'__ by AGulev


__FIX__: ([#11204](https://github.com/defold/defold/pull/11204)) __'Vulkan fix validation errors'__ by Jhonnyg
Multiple validation errors have been fixed for the Vulkan graphics adapter. This essentially means that the Vulkan backend should be more stable and reliant than before. Please let us know if you encounter more validation errors!

### Technical Changes

* We now use the 'current frame in flight'-index when managing resources instead of the swap chain index. This means we can manage these independantly
* Each resource carries a number that indicates which frame-in-flight it was used in, so they can be correctly removed even if they are used outside of the VulkanBegin ... VulkanFlip flow
* Attachments for MSAA now have the correct initial state (clear), so we avoid the 'disco effect' of uninitialized memory
* Resources should be correctly cleaned now

__FIX__: ([#11233](https://github.com/defold/defold/pull/11233)) __'On opengl the graphics frame start now sets the default framebuffer'__ by JCash
This helps when other extensions accidentally leave the wrong framebuffer set.

Also added `dmGraphics::OpenGLGetDefaultFramebufferId(context)` to `dmSDK`

__FIX__: ([#11235](https://github.com/defold/defold/pull/11235)) __'New public APIs'__ by ekharkunov
Added new public APIs

```cpp
// dmGraphics namespace

uint32_t GetWindowWidth(HContext context);
uint32_t GetWindowHeight(HContext context);
uint32_t GetWidth(HContext context);
uint32_t GetHeight(HContext context);
void SetStencilMask(HContext context, uint32_t mask);
void SetStencilFunc(HContext context, CompareFunc func, uint32_t ref, uint32_t mask);
void SetStencilFuncSeparate(HContext context, FaceType face_type, CompareFunc func, uint32_t ref, uint32_t mask);
void SetStencilOp(HContext context, StencilOp sfail, StencilOp dpfail, StencilOp dppass);
void SetStencilOpSeparate(HContext context, FaceType face_type, StencilOp sfail, StencilOp dpfail, StencilOp dppass);
void EnableState(HContext context, State state);
void DisableState(HContext context, State state);
void SetBlendFunc(HContext context, BlendFactor source_factor, BlendFactor destinaton_factor);
void SetColorMask(HContext context, bool red, bool green, bool blue, bool alpha);
void SetDepthMask(HContext context, bool enable_mask);
void SetDepthFunc(HContext context, CompareFunc func);
HContext GetInstalledContext();
HRenderTarget NewRenderTarget(HContext context, uint32_t buffer_type_flags, const RenderTargetCreationParams params);
void DeleteRenderTarget(HContext context, HRenderTarget render_target);
void SetRenderTarget(HContext context, HRenderTarget render_target, uint32_t transient_buffer_types);
HTexture GetRenderTargetTexture(HContext context, HRenderTarget render_target, BufferType buffer_type);
void GetRenderTargetSize(HContext context, HRenderTarget render_target, BufferType buffer_type, uint32_t& width, uint32_t& height);
void SetRenderTargetSize(HContext context, HRenderTarget render_target, uint32_t width, uint32_t height);
PipelineState GetPipelineState(HContext context);
void SetCullFace(HContext context, FaceType face_type);
void RepackRGBToRGBA(uint32_t num_pixels, uint8_t* rgb, uint8_t* rgba);
float GetDisplayScaleFactor(HContext context);
```

```cpp
// dmRender namespace

const dmVMath::Matrix4& GetViewMatrix(HRenderContext render_context);
HMaterial NewMaterial(HRenderContext render_context, dmGraphics::HProgram program);
void DeleteMaterial(HRenderContext render_context, HMaterial material);
void ClearMaterialTags(HMaterial material);
void SetMaterialTags(HMaterial material, uint32_t tag_count, const dmhash_t* tags);
bool SetMaterialSampler(HMaterial material, dmhash_t name_hash, uint32_t unit, dmGraphics::TextureWrap u_wrap, dmGraphics::TextureWrap v_wrap, dmGraphics::TextureFilter min_filter, dmGraphics::TextureFilter mag_filter, float max_anisotropy);
dmhash_t GetMaterialSamplerNameHash(HMaterial material, uint32_t unit);
uint32_t GetMaterialSamplerUnit(HMaterial material, dmhash_t name_hash);
void ApplyMaterialConstants(HRenderContext render_context, HMaterial material, const RenderObject* render_object);
```

__FIX__: ([#10921](https://github.com/defold/defold/pull/11180)) __'Vulkan improve texture upload performance'__ by Jhonnyg
Performance for dynamic texture uploads have been improved when using the Vulkan backend.

__FIX__: ([#9917](https://github.com/defold/defold/pull/9943)) __'Fix frustrum culling for sprites with pivot point'__ by ekharkunov
Fixed culling for sprites with pivot points. Also implemented some optimization on how geometry data calculated and stored between batches. So no it should be a bit faster in terms of calculation but consume some memory to store cached information.


## Editor
__BREAKING CHANGE__: ([#11163](https://github.com/defold/defold/pull/11178)) __'Allow setting game.project properties using editor scripts'__ by vlaaad
Now, it's possible to set properties in the `game.project` file using editor scripts:
```lua
editor.transact({
    editor.tx.set("/game.project", "project.dependencies", {
        "https://github.com/defold/extension-spine/archive/refs/tags/3.10.0.zip"
    })
})
```

🚨 **Breaking change** 🚨 for extensions that are based on [extension-simpledata](https://github.com/defold/extension-simpledata): Now, the editor expects the code that is invoked when form values are set/cleared to return transaction steps instead of performing a transaction. See [this PR](https://github.com/defold/extension-simpledata/pull/19/files) for the changes you need to make.

__NEW__: ([#11147](https://github.com/defold/defold/pull/11152)) __'Disallow non-top-level go.property calls in scripts'__ by vlaaad


__NEW__: ([#10601](https://github.com/defold/defold/pull/11148)) __'Move deleted files into trash bin'__ by vlaaad


__NEW__: ([#11158](https://github.com/defold/defold/pull/11170)) __'Show literal labels for user-defined properties'__ by matgis
We now label user-defined properties in the Property Editor using the literal name the property was declared as.

__FIX__: ([#11159](https://github.com/defold/defold/pull/11159)) __'Suggest fetching libraries when modifying game.project dependencies'__ by vlaaad
We now show a notification when dependencies change:
<img width="450" height="184" alt="Screenshot 2025-08-29 at 10 21 09" src="https://github.com/user-attachments/assets/ad9126bf-1452-4233-99eb-022e16ea88d1" />

__FIX__: ([#11141](https://github.com/defold/defold/pull/11179)) __'Fix Console not working when the custom resolution feature is enabled'__ by AGulev
Fixes the issue where logs in the Editor's console don't work when Simulated Resolution is used (Windows only).

__FIX__: ([#11189](https://github.com/defold/defold/pull/11189)) __'Decrease editor size by 12 MB'__ by vlaaad


__FIX__: ([#11174](https://github.com/defold/defold/issues/11174)) __'Beta editors do not use the beta build server by default'__ by NaakkaDev
**Describe the bug (REQUIRED)**
Apparently the beta editor builds should use the beta build server by default as long the value is not set in the preferences. That is not my experience as I always had to set the build server to "https://build-stage.defold.com" when using beta editors.

**To Reproduce (REQUIRED)**
Steps to reproduce the behavior:
1. Go to editor preferences > Extensions in a beta editor.
2. See the build server input field with placeholder text "https://build.defold.com" instead of "https://build-stage.defold.com"

**Expected behavior (REQUIRED)**
Beta editor uses the beta build server when the build server input field is empty (displays the placeholder text).

**Defold version (REQUIRED):**
  - Version 1.11.0 BETA and earlier.

**Platforms (REQUIRED):**
 - Platforms: Windows /  Linux
 - OS: Windows 10 / Arch Linux
 - Device: PC

__FIX__: ([#11191](https://github.com/defold/defold/pull/11234)) __'Fixed code editor freeze when matching against very long strings'__ by matgis
* Rewrote the fuzzy text matching algorithm to use less memory and perform matches faster.
* Fixed a freeze that could occur in the code editor when attempting to perform a fuzzy text match against very long autocomplete suggestions originating from non-Lua files in some projects.
* Fixed an exception that would occur if a fuzzy text search term included the Turkish capital letter I (`İ`) on a machine running under a non-Turkish locale setting.

