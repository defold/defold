import re
import Task, TaskGen
from TaskGen import extension, declare_extension

def build(bld):
    test_gui = bld.new_task_gen(features = 'cxx cprogram embed test',
                                includes = '../../../src .',
                                uselib = 'GTEST SCRIPT EXTENSION RESOURCE HID_NULL DDF DLIB PLATFORM_SOCKET LUA SOL_RUNTIME SOL',
                                uselib_local = 'gui',
                                target = 'test_gui',
                                source = 'test_gui.cpp test_gui_ddf.proto',
                                embed_source = 'bug352.lua')

    test_gui.install_path = None

    test_gui_script = bld.new_task_gen(features = 'cxx cprogram embed test',
                                includes = '../../../src .',
                                uselib = 'GTEST SCRIPT EXTENSION RESOURCE HID_NULL DDF DLIB PLATFORM_SOCKET LUA SOL_RUNTIME SOL',
                                uselib_local = 'gui',
                                target = 'test_gui_script',
                                source = 'test_gui_script.cpp')

    test_gui_script.install_path = None

    test_gui_clipping = bld.new_task_gen(features = 'cxx cprogram embed test',
                                includes = '../../../src .',
                                uselib = 'GTEST SCRIPT EXTENSION RESOURCE HID_NULL DDF DLIB PLATFORM_SOCKET LUA SOL_RUNTIME SOL',
                                uselib_local = 'gui',
                                target = 'test_gui_clipping',
                                source = 'test_gui_clipping.cpp')

    test_gui_clipping.install_path = None

    if not (re.match('arm.*?darwin', bld.env.PLATFORM) or re.match('arm.*?android', bld.env.PLATFORM)):
        guidemo = bld.new_task_gen(features = 'cxx cprogram test',
                                   includes = '../../../src',
                                   uselib = 'SCRIPT EXTENSION RESOURCE HID DDF DLIB PLATFORM_SOCKET LUA DMGLFW X SOL_RUNTIME SOL',
                                   uselib_local = 'gui',
                                   target = 'guidemo',
                                   source = 'guidemo.cpp')

        guidemo.install_path = None
