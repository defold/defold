diff --git a/include/gtest/internal/gtest-port.h b/include/gtest/internal/gtest-port.h
index a2a62be..ac2b1c3 100644
--- a/include/gtest/internal/gtest-port.h
+++ b/include/gtest/internal/gtest-port.h
@@ -222,7 +222,7 @@
 #endif  // __CYGWIN__
 
 #if GTEST_OS_CYGWIN || GTEST_OS_LINUX || GTEST_OS_MAC || GTEST_OS_SYMBIAN || \
-    GTEST_OS_SOLARIS || GTEST_OS_AIX
+    GTEST_OS_SOLARIS || GTEST_OS_AIX || EMSCRIPTEN
 
 // On some platforms, <regex.h> needs someone to define size_t, and
 // won't compile otherwise.  We can #include it here as we already
@@ -484,7 +484,7 @@
 // pops up a dialog window that cannot be suppressed programmatically.
 #if (GTEST_OS_LINUX || GTEST_OS_MAC || GTEST_OS_CYGWIN || GTEST_OS_SOLARIS || \
      (GTEST_OS_WINDOWS_DESKTOP && _MSC_VER >= 1400) || \
-     GTEST_OS_WINDOWS_MINGW || GTEST_OS_AIX)
+     GTEST_OS_WINDOWS_MINGW || GTEST_OS_AIX) && !defined(TVOS)
 #define GTEST_HAS_DEATH_TEST 1
 #include <vector>  // NOLINT
 #endif
diff --git a/src/gtest-death-test.cc b/src/gtest-death-test.cc
index 3b73b01..4d89c75 100644
--- a/src/gtest-death-test.cc
+++ b/src/gtest-death-test.cc
@@ -36,9 +36,9 @@
 
 #if GTEST_HAS_DEATH_TEST
 
-#if GTEST_OS_MAC
+#if GTEST_OS_MAC_
 #include <crt_externs.h>
-#endif  // GTEST_OS_MAC
+#endif  // GTEST_OS_MAC_
 
 #include <errno.h>
 #include <fcntl.h>
@@ -832,7 +832,7 @@ struct ExecDeathTestArgs {
   int close_fd;       // File descriptor to close; the read end of a pipe
 };
 
-#if GTEST_OS_MAC
+#if GTEST_OS_MAC_
 inline char** GetEnviron() {
   // When Google Test is built as a framework on MacOS X, the environ variable
   // is unavailable. Apple's documentation (man environ) recommends using
@@ -844,7 +844,7 @@ inline char** GetEnviron() {
 // it reside in the global namespace.
 extern "C" char** environ;
 inline char** GetEnviron() { return environ; }
-#endif  // GTEST_OS_MAC
+#endif  // GTEST_OS_MAC_
 
 // The main function for a threadsafe-style death test child process.
 // This function is called in a clone()-ed process and thus must avoid
diff --git a/src/gtest.cc b/src/gtest.cc
index 342d458..64e8be3 100644
--- a/src/gtest.cc
+++ b/src/gtest.cc
@@ -1644,7 +1644,7 @@ bool String::CaseInsensitiveWideCStringEquals(const wchar_t* lhs,
 
 #if GTEST_OS_WINDOWS
   return _wcsicmp(lhs, rhs) == 0;
-#elif GTEST_OS_LINUX
+#elif GTEST_OS_LINUX && !defined(ANDROID)
   return wcscasecmp(lhs, rhs) == 0;
 #else
   // Mac OS X and Cygwin don't define wcscasecmp.  Other unknown OSes
